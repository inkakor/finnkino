package com.example.harjoitustyoolio;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.text.Editable;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.RatingBar;
import android.widget.Spinner;
import android.widget.TextView;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.Set;

public class Review extends AppCompatActivity {
    ArrayList<ReviewList > watchedMovies = new ArrayList<>();
    ArrayList<String> movies;

    private EditText reviewText;
    private Spinner movieSpinner;
    private RatingBar ratingBar;
    private TextView rateStars;

    SharedPreferences shared;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_review);

        if(movies == null){
            movies = new ArrayList<>();
        }

        shared = getSharedPreferences("App_settings", MODE_PRIVATE);

        ratingBar = (RatingBar) findViewById(R.id.ratingBar);
        Button rateButton = (Button) findViewById(R.id.reviewB);
        rateStars = (TextView) findViewById(R.id.textView2);
        reviewText = (EditText)findViewById(R.id.writtenReview);
        Button submitButton = (Button) findViewById(R.id.submitB);
        movieSpinner = (Spinner) findViewById(R.id.reviewS);
        final TextView title = (TextView) findViewById(R.id.textView3);

        Bundle bundleObject = getIntent().getExtras();
        movies = (ArrayList<String>) bundleObject.getSerializable("movies");
        watchedMovies = (ArrayList<ReviewList>) bundleObject.getSerializable("watchedmovies");


        //configure();



        // tähän lista jossa katsotut elokuvat ovat
        //spinner that shows a list of watched movies: user chooses one of the movies and rates it with stars/written review
        ArrayAdapter spinnerAdapter = new ArrayAdapter<>(Review.this, android.R.layout.simple_spinner_dropdown_item, movies);
        movieSpinner.setAdapter(spinnerAdapter);
        movieSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
            @Override
            public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {
            }
            @Override
            public void onNothingSelected(AdapterView<?> adapterView) {
            }
        });

        //rating watched movies with stars from 1 to 5
        rateButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                rateStars.setText("Your rating is: "+ratingBar.getRating());
                //tähän toiminto joka lisää tekstin listaan?
            }
        });


        //written review on the movie
        /*
        submitButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                //tähän toiminto joka lisää tekstin listaan painamalla submit buttonia
            }
        });

         */
    }

    /*
    @Override
    protected void onSaveInstanceState(Bundle outState){
        super.onSaveInstanceState(outState);
        outState.putSerializable("movies", movies);
        for (int i = 0; i < movies.size(); i++) {
            System.out.println("PRINT");
            System.out.println(movies.get(i));
        }
        outState.putSerializable("watchedmovies", watchedMovies);
    }
    @Override
    protected void onRestoreInstanceState(Bundle savedInstanceState){
        movies = (ArrayList<String>) savedInstanceState.getSerializable("movies");
        for (int i = 0; i < movies.size(); i++) {
            System.out.println("PRINT");
            System.out.println(movies.get(i));
        }
        watchedMovies = (ArrayList<ReviewList>) savedInstanceState.getSerializable("watchedmovies");
    }

     */


    public void setRatings(View v){
        String chosenItem = movieSpinner.getSelectedItem().toString();
        System.out.println(chosenItem);
        String date = "";
        Editable review;
        int index = 0;
        float rate;
        for (int i = 0; i < watchedMovies.size(); i++) {
            if(chosenItem.equals(watchedMovies.get(i).mName)){
                System.out.println(watchedMovies.get(i).mName + " " + watchedMovies.get(i).date);
                //date = watchedMovies.get(i).date;
                index = i;
                break;
            }
        }
        if(watchedMovies.get(index).review.equals("")){
            reviewText.setText("Write your review here!");
        }else{
            reviewText.setText(watchedMovies.get(index).review);
        }
        if(watchedMovies.get(index).rate == 0){
            rateStars.setText("Your rating will appear here");
        }else{
            ratingBar.setRating(watchedMovies.get(index).rate);
        }
    }
    
    public void saveRatings(View v){
        System.out.println("EKA save");
        String date = "";
        Editable review;
        int index = 0;
        float rate;
        String chosenItem = movieSpinner.getSelectedItem().toString();
        for (int i = 0; i < watchedMovies.size(); i++) {
            if(chosenItem.equals(watchedMovies.get(i).mName)){
                date = watchedMovies.get(i).date;
                index = i;
            }
        }
        rate = ratingBar.getRating();
        review = reviewText.getText();
        String review1 = String.valueOf(review);
        System.out.println("##### SAve ratings" + rate + " " + review + " " + chosenItem);
        watchedMovies.set(index, new ReviewList(chosenItem, date, rate, review1));

        ratingBar.setRating(0);
        reviewText.setText("");
    }

}
